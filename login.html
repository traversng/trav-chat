<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
    <!-- Latest Font Awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
    <style>
        body {
            padding-top: 15px;
            font-size: 12px
        }
        .main {
            max-width: 320px;
            margin: 0 auto;
        }
        .login-or {
            position: relative;
            font-size: 18px;
            color: #aaa;
            margin-top: 10px;
            margin-bottom: 10px;
            padding-top: 10px;
            padding-bottom: 10px;
        }
        .span-or {
            display: block;
            position: absolute;
            left: 50%;
            top: -2px;
            margin-left: -25px;
            background-color: #fff;
            width: 50px;
            text-align: center;
        }
        .hr-or {
            background-color: #cdcdcd;
            height: 1px;
            margin-top: 0px !important;
            margin-bottom: 0px !important;
        }
        h3 {
            text-align: center;
            line-height: 300%;
        }

        #github-btn{
            background-color: #444444;
            color: white;
        }

        #google-btn{
            background-color: #DD4B39;
            color: white;
        }

        #facebook-btn{
            background-color: #3B5998;
            color: white;
        }
    </style>
    <script src="https://cdn.firebase.com/js/client/2.3.1/firebase.js"></script>
</head>
<body>
<div class="row">
    <div class="main">
        <h3>Please Log In, or <a href="#">Sign Up</a></h3>
        <div class="row">
            <a id="facebook-btn" class="btn btn-block btn-social btn-facebook">
                <span class="fa fa-facebook"></span> Sign in with Facebook
            </a>
            <a id="google-btn" class="btn btn-block btn-social btn-google">
                <span class="fa fa-google"></span> Sign in with Google
            </a>
            <a id="github-btn" class="btn btn-block btn-social btn-github">
                <span class="fa fa-github"></span> Sign in with GitHub
            </a>
        </div>
        <div class="login-or">
            <hr class="hr-or">
            <span class="span-or">or</span>
        </div>
        <div id="login-wrap">
            <form id="login-form" role="form" method="post" action="/login">
                <div class="form-group">
                    <label for="usernameEmail">Username or email</label>
                    <input type="text" class="form-control" id="usernameEmail">
                </div>
                <div class="form-group">
                    <a class="pull-right" href="#">Forgot password?</a>
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password">
                </div>
                <div class="checkbox pull-right">
                    <label>
                        <input type="checkbox">
                        Remember me </label>
                </div>
                <button type="submit" class="btn btn btn-primary">
                    Log In
                </button>
            </form><!-- login-form -->
        </div>
    </div>
</div>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdn.socket.io/socket.io-1.3.7.js"></script>
<script>
    $(function($){
        var socket = io.connect();
        var ref = new Firebase('https://travcast.firebaseio.com');//This creates a connection to our unique firebase db
        var usersRef = ref.child("users");//Creates and uses a database child called users...this is where we will store our users information
        var $loginForm = $('#login-form');
        var $username = $('#usernameEmail');
        var $password = $('#password');
        var $facebookBtn = $('#facebook-btn');
        var $githubbtn = $('#github-btn');
        var $googlebtn = $('#google-btn');


        // Google authentication and user creation
        $googlebtn.click(function(){
            ref.authWithOAuthPopup("google", function(error, authData) {
                if (error) {
                    console.log("Login Failed!", error);
                } else {
                    console.log("Authenticated successfully with payload:", authData);
                    var newUser = usersRef.push();
                    newUser.set({
                        userInfoSrc: authData.provider,
                        name: authData.google.displayName
                    });
                    // add socket event to trigger index.html here...
                    var authenticUser = {
                        name: authData.google.displayName,
                        userInfoSrc: authData.provider
                    };
                    socket.emit('successful login', authenticUser, function(data){
                        console.log('successful login data: ' +data+ 'authenticUser: ' +authenticUser);
                    });
                }
            });
        });

        // Github authentication and user creation
        $githubbtn.click(function(){
            ref.authWithOAuthPopup("github", function(error, authData) {
                if (error) {
                    console.log("Login Failed!", error);
                } else {
                    console.log("Authenticated successfully with payload:", authData);
                    var newUser = usersRef.push();
                    newUser.set({
                        userInfoSrc: authData.provider,
                        name: authData.github.displayName
                    });
                }
            });
        });

        // facebook authentication and user creation
        $facebookBtn.click(function(){
            ref.authWithOAuthPopup("facebook", function(error, authData) {
                if (error) {
                    console.log("Login Failed!", error);
                } else {
                    console.log("Authenticated successfully with payload:", authData);
                    var newUser = usersRef.push();
                    newUser.set({
                        userInfoSrc: authData.provider,
                        name: authData.facebook.displayName
                    });

                }
            });

            // Email password user creation/login
            $loginForm.submit(function(e){
                var newUser = usersRef.push();// Pushing to the existing ref.child('users') creates a new user child everytime this form is submitted whereas if we were to use usersRef.set() we would be overidding the user child everytime
                newUser.set({
                    username: $username.val(),
                    password: $password.val()
                });
                console.log('username: ' +username+ 'password: ' + password);
            });
        });
    });
</script>
</body>
</html>